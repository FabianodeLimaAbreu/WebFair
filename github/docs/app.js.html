<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>DocStrap Source: app.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">DocStrap</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="module-App.html">App</a>
						</li>
						
						<li>
							<a href="module-Box.html">Box</a>
						</li>
						
						<li>
							<a href="module-Detail.html">Detail</a>
						</li>
						
						<li>
							<a href="module-Login.html">Login</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="App.html">App</a>
						</li>
						
						<li>
							<a href="Box.html">Box</a>
						</li>
						
						<li>
							<a href="Content.html">Content</a>
						</li>
						
						<li>
							<a href="Detail.html">Detail</a>
						</li>
						
						<li>
							<a href="Login.html">Login</a>
						</li>
						
						<li>
							<a href="Menu.html">Menu</a>
						</li>
						
						<li>
							<a href="Modal.html">Modal</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: app.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/**
*@fileOverview Main application class, responsible for all main funcionalities and call anothers classes constructors
* @module App
*
*/

require.config({
  shim: {
    spine: {
      deps: ["jquery"],
      exports: "Spine"
    }
  },
  baseUrl: "js/lib",
  paths: {
    app: "../app",
    models: "../models",
    sp: "spine"
  }
});
require(["methods","sp/min", "app/content"/*, "app/detail"*/], function() {
  /**
  * Main application class, responsible for all main funcionalities and call anothers classes constructors
  * @exports App
  * @constructor
  */
  window.App = Spine.Controller.sub({
    el:$("body"),
    elements: {
      ".container":"container",
      ".nav-menu a":"menuopt",
      "header":"header",
      ".content":"contentEl",
      "#wrap .mask":"maskEl",
      //".form-control":"searchEl",
      //".right-list button":"viewBtn",
      //"button.close":"closeBtn",
      ".login-name":"username",
      //".table-container":"viewList",
      /*".viewport":"viewImage",
      ".bread-box":"breadEl",
      "#modal" : "modalEl",
      ".detail":"detailEl"*/
    },

    events: {      
      "click .changeview button":"changeview",
      "click .tooltip.borderby .tooltip-item":"sortItems",
      "click .bsel":"selectItems",
      "click .btrash-big":'deleteNote',
      "click .bfav":'actionHeart',
      "click .bfisica":'actionFlag',
      "click .bhomologado":'actionHomolog',
      "change .countries": "changeCountries",
      "change .city": "changeCity",
      "keyup .forn": "getSpot",
      "change .fair":"changeFair",
      "click .export":"exportExcel",
      "blur .form-control-search":"search",
      "keyup .form-control-search":"search",
      "change .filter-data":"filterForn",
      "click .caption-downside a":"compChange",
      "click .edit-fair":"editFair",
      "click .fair-save":"saveFair",
      "click .delete-fair":"deleteFair"
      /*"submit .search":"submit",
      "click button.icon.go_back_default":"goBack",
      "click button.close":"getOut"*/
    },
    init:function(){
      this.view = "images";
      this.page = "amostras";
      this.itens = $([]);
      this.data=[];
      this.fdata = [];
      this.loading=!1;
      this.callback=null;
      this.bfair;
      this.bforn; 

      //Var to storage the basic data
      this.fair=[];
      this.ffair=[];
      this.cities=[];
      this.forn=[];
      this.segm=[];
      this.select_items=[];
      this.fairval="";
      this.fornval="";
      this.amosval="";
      this.initialTime='2015-01-08';
      this.endTime='2015-10-10';
      this.notcombo=0;



      /*this.loja="";
      this.area="";
      this.father=!0;
      this.searchname="";*/
      this.breadarr = [];
      //this.modal = new Modal({el:this.modalEl});
      //this.detail = new Detail({el:this.detailEl, breadEl:this.breadEl,getloading:this.proxy(this.getloading), setloading:this.proxy(this.setloading),stage:this.proxy(this.stage), body:this.el,getdata:this.proxy(this.getdata)});

      this.header.addClass("goDown");
      this.usr = jQuery.parseJSON($.cookie("webfair"));
      if(!this.usr)
        window.location.href = 'login.html';
      this.username.text(this.usr.USU_NOME);
      
      this.el.find("#wrap").removeClass("hide");

      this.content = new Content({el:this.contentEl,usr_segm:this.usr.SEGM_COD,/*bread:this.breadEl, type:this.usr.TIPO*/});
      this.spotlight = new Spotlight({
        callService:this.proxy(this.callService),
        reset:this.proxy(this.reset),
        getFornVal:this.proxy(this.getFornVal),
        setFornVal:this.proxy(this.setFornVal),
        getFairVal:this.proxy(this.getFairVal),
        setFairVal:this.proxy(this.setFairVal),
        getNotCombo:this.proxy(this.getNotCombo),
        setNotCombo:this.proxy(this.setNotCombo),
        getPage:this.proxy(this.getPage)
      });

      if(!this.fair.length){
        this.callService("local",'&lt;FEIR_COD>&lt;/FEIR_COD>','&lt;PAIS_COD>&lt;/PAIS_COD>','&lt;REGI_COD>&lt;/REGI_COD>');
      }
      /*if(!this.forn.length){
        this.callService("fornecedores",'&lt;FEIR_COD>&lt;/FEIR_COD>','&lt;PAIS_COD>&lt;/PAIS_COD>','&lt;REGI_COD>&lt;/REGI_COD>');
      }*/
      // this.spotlight = new Spotlight({el:this.spotEl});
      this.routes({
        "":function() {
          this.menuopt.eq(3)[0].click();
        },
        "amostras":function(){
          var context=this;
          this.page ="amostras";
          $("html").attr("class","").addClass(this.page);
          this.writePage(this.page);
        },
        "fornecedores":function(){
          var context=this;
          this.page ="fornecedores";
          $("html").attr("class","").addClass(this.page);
          this.writePage(this.page);
        },
        "fornecedores/*code":function(a){
          var context=this;
          this.page ="fornecedor_cadastro";
          $("html").attr("class","").addClass(this.page);
          this.writePage(this.page);
        },
        "relatorio":function(){
          var context=this;
          this.page ="relatorio";
          this.writePage(this.page);
        },
        "local":function(){
          var context=this;
          this.page ="local";
          $("html").attr("class","").addClass(this.page);
          this.writePage(this.page);
        },
        "local/*func/*code":function(a){
          var context=this;
          this.page ="local_cadastro";
          $("html").attr("class","local_cadastro view_fair");
          this.writePage(this.page,a.code);
        },
        "local/*func":function(a){
          var context=this;
          this.page ="local_cadastro";
          $("html").attr("class","local_cadastro add_fair");
          this.writePage(this.page,"new");
        },
        "template_email":function(){
          var context=this;
          this.page ="template_email";
          this.writePage(this.page);
        },
        "gestao":function(){
          var context=this;
          this.page ="gestao";
          this.writePage(this.page);
        },
        "detail/*code" : function(a) {
          alert(a.code);
          //this.detail.reload(a.code);
        }
      });
    },

    getOut : function(a){
      a.preventDefault();
      Logout();
    },
    goBack : function(){
      if(this.father){
        window.location.href = './#'+this.loja;
      }else{
        var bread = $('.bread-colec').find("a").text();
        var grupo = this.data[0].GRUPO;
        var area = this.data[0].TYPE_MAT;
        this.navigate &amp;&amp; this.navigate("artigos-pai", this.loja,area,grupo,!0);        
      }       

    },
    writePage:function(hash,val){
      var context=this;
      context.reset();
      context.restartValues();
      this.container.load("pages/"+hash+".html",function( response, status, xhr){
        switch(context.page){
          case "amostras":
            context.viewBtn=$(".changeview button");
            context.order_box=$(".tooltip.borderby");
            context.bfair=$(".fair");
            context.bforn=$(".forn");
            context.spotlight.el=$(".spotlight");
            this.view = "images";
            $("body").removeAttr("class");
            context.createComponent(context.fair,context.bfair,'fair');
            //context.callService("fornecedores",'&lt;FORN_DESC>&lt;/FORN_DESC>','&lt;FEIR_COD>&lt;/FEIR_COD>','&lt;CREATE_DATE_I>1900-10-17&lt;/CREATE_DATE_I>','&lt;CREATE_DATE_F>2020-10-17&lt;/CREATE_DATE_F>',20);
            break;
          case "fornecedores":
            context.bfair=$(".fair");
            context.bforn=$(".forn");
            context.spotlight.el=$(".spotlight");
            context.createComponent(context.fair,context.bfair,'fair');
            //console.dir(context.fair);
            break;
          case "local":
            context.bcity=$(".city");
            //context.callService(context.page,"&lt;FEIR_COD>&lt;/FEIR_COD>","&lt;PAIS_COD>BR&lt;/PAIS_COD>","&lt;REGI_COD>SP&lt;/REGI_COD>");
            break;
          case "local_cadastro":
            context.bcity=$(".city");
            if(context.ffair.length){
              context.createComponent(context.cities,context.bcity,"cities");
              context.fair.filter(function(a,b){
                if((parseInt(a.FEIR_COD) == (parseInt(val)))){
                  context.popComponent(a);
                }
              });
            }
            else{
              //Mandar para pagina anterior
            }
            //context.callService(context.page,"&lt;FEIR_COD>&lt;/FEIR_COD>","&lt;PAIS_COD>BR&lt;/PAIS_COD>","&lt;REGI_COD>SP&lt;/REGI_COD>");
            break;
          case "fornecedor_cadastro":
            console.log("fornecedor cadastro");
            /*$('body').scrollspy({ target: '.ScrollSpy' });
            $('ul.nav-list li a').bind('click', function(e) {
              console.dir($(this.hash));
              e.preventDefault();
              $('.supplier-scroller').animate({scrollTop: $(this.hash).position().top});
            });*/
            break;
          default:
            alert("dssda");
        }
      });
    },
    popComponent:function(item){
      var elem=$(".form-control");
      elem.each(function(a,b){
        $(b).attr("disabled","disabled").val(item[$(b).attr("name")]);
      });
      this.fairval=item;
    },
    editFair:function(a){
      $(a.target).addClass("sel");
      $("html").attr("class","local_cadastro edit");
      var elem=$(".form-control").removeAttr("disabled");
    },
    saveFair:function(){
      var elem=$(".form-control"),html="";
      if($("html").hasClass("edit")){
        html+="&lt;FEIR_COD>"+parseInt(this.fairval.FEIR_COD)+"&lt;/FEIR_COD>";
        elem.each(function(a,b){
          //console.log($(b).attr("class"));
          if($(b).hasClass("bselect")){
            //console.log($(b).find("option:selected").val());
            html+="&lt;"+$(b).attr("name")+">"+$(b).find("option:selected").val().replace(' ',"")+"&lt;/"+$(b).attr("name")+">";
          }
          else{
            html+="&lt;FEIR_DESC>"+$(b).val()+"&lt;/FEIR_DESC>";
          }
        });
        //html+="&lt;CREATE_DATE>"+new Date().toLocaleDateString().replace("/","-").replace("/","-")+"&lt;/CREATE_DATE>";
        html+="&lt;CREATE_DATE>"+"2015-12-12"+"&lt;/CREATE_DATE>";
        this.callService("gravarLocal",html,"U");
      }
      else{
        html+="&lt;FEIR_COD>24&lt;/FEIR_COD>";
        elem.each(function(a,b){
          //console.log($(b).attr("class"));
          if($(b).hasClass("bselect")){
            //console.log($(b).find("option:selected").val());
            html+="&lt;"+$(b).attr("name")+">"+$(b).find("option:selected").val().replace(' ',"")+"&lt;/"+$(b).attr("name")+">";
          }
          else{
            html+="&lt;FEIR_DESC>"+$(b).val()+"&lt;/FEIR_DESC>";
          }
        });
        //html+="&lt;CREATE_DATE>"+new Date().toLocaleDateString().replace("/","-").replace("/","-")+"&lt;/CREATE_DATE>";
        html+="&lt;CREATE_DATE>"+"2015-12-12"+"&lt;/CREATE_DATE>";
        this.callService("gravarLocal",html,"I");
      }
    },
    deleteFair:function(){
      console.log(this.fairval);
      var html="";
      html+="&lt;FEIR_COD>"+parseInt(this.fairval.FEIR_COD)+"&lt;/FEIR_COD>"+"&lt;CREATE_DATE>"+"2015-12-12"+"&lt;/CREATE_DATE>";
      this.callService("gravarLocal",html,"D");
    },
    setBreadcrumb : function(a, val){
      var loja, area, grupo, artigo, bread_text;
        
      // Error
      if(!a[0]){
        return this.modal.open(),this.breadEl.find('.bread-colec a').text("").removeClass('active'),this.setloading(!1), this.searchEl.find('input').blur();
      }

      loja        = a[0].DESC_STORE;
      grupo       = a[0].GRUPO;
      area        = a[0].TYPE_MAT;
      artigo      = this.artigo;
      bread_text  = loja+' - '+area+' - '+val;



      // FILHO
      if(!loja){
        this.area=a[0].TYPE_MAT;
        this.breadEl.find('.bread-colec a').text(area+' - '+grupo+' - '+artigo).addClass('active');
        return false;
      }
      // PAI      
      (this.area=="X") ? (bread_text=loja+' - '+val) : bread_text=(loja+' - '+area+' - '+val);
      this.breadEl.find('.bread-colec a').text(bread_text).addClass('active')   
    },
    changeview : function(a) {
      if ("object" === typeof a) {
          a.preventDefault(), a = $(a.target);
      } else {
          return !1;
      }
      /*if (this.loading){
        return !1;
      }*/ 
      $(".thumbnail .icon").attr("class","icon");
      $("html").attr("class","amostras");
      a.hasClass("sel") || (this.viewBtn.removeClass("sel"), a.addClass("sel"), this.view = a.attr('alt'), this.setdata(this.data, "amostras"));
    },
    setMenu:function(loja){
        if(this.menuopt.hasClass("sel")){
          this.menuopt.removeClass("sel");
        }
        this.menuopt.each(function(a,b){
          if(b.hash === "#"+loja){
            $(b).addClass("sel");
          }        
        });
    },
    callService:function(name,a,b,c,d,e,f,g){
        var core=this;
        var soapRequest=[
          {
            //FEIR_COD e FORN_ID are optional fields
            'name':'amostras',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;ListarAmostras xmlns="http://tempuri.org/">'+a+''+b+''+c+''+d+''+e+''+f+''+g+'&lt;/ListarAmostras>&lt;/soap:Body>&lt;/soap:Envelope>',
            callback:function(data,req){
              core.convertData(data,req,name);
            }
          },
          {
            'name':'delete',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;GravarAnotacao xmlns="http://tempuri.org/">&lt;note>&lt;NOTA_ID>'+a+'&lt;/NOTA_ID>&lt;USU_COD>'+b+'&lt;/USU_COD>&lt;PLAT_ID>2&lt;/PLAT_ID>&lt;CREATE_DATE>2016-07-08&lt;/CREATE_DATE>&lt;/note>&lt;action>D&lt;/action>&lt;/GravarAnotacao>&lt;/soap:Body>&lt;/soap:Envelope>',
            'callback':null
          },
          {
            'name':'local',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;ListarFeiras xmlns="http://tempuri.org/">'+a+''+b+''+c+'&lt;/ListarFeiras>&lt;/soap:Body>&lt;/soap:Envelope>',
            callback:function(data,req){
              core.convertData(data,req,name);
            }
          },
          {
            'name':'gravarLocal',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;GravarFeira xmlns="http://tempuri.org/">&lt;fair>'+a+'&lt;/fair>&lt;action>'+b+'&lt;/action>&lt;/GravarFeira>&lt;/soap:Body>&lt;/soap:Envelope>',
            callback:function(data,req){
              alert("gravou no banco");
              //core.convertData(data,req,name);
              window.location.reload();
            }
          },
          {
            'name':'fornecedores',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;ListarFornecedores xmlns="http://tempuri.org/">'+a+''+b+''+c+''+d+''+e+''+f+'&lt;/ListarFornecedores>&lt;/soap:Body>&lt;/soap:Envelope>',
            callback:function(data,req){
              if(core.notcombo){
                core.convertData(data,req,name,!0);
              }
              core.convertData(data,req,name);
            }
          },
          {
            'name':'cities',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;ListarRegioes xmlns="http://tempuri.org/">'+a+''+b+''+c+''+d+'&lt;/ListarRegioes>&lt;/soap:Body>&lt;/soap:Envelope>',
            callback:function(data,req){
              core.convertData(data,req,name);
            }
          },
          {
            'name':'gravarAmostraComposicao',
            'code':'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;GravarAmostraComposicao xmlns="http://tempuri.org/">&lt;AMOS_ID>'+a+'&lt;/AMOS_ID>&lt;compositions>'+b+'&lt;/compositions>&lt;/GravarAmostraComposicao>&lt;/soap:Body>&lt;/soap:Envelope>',
            'callback':null
          },
        ];

        $.support.cors=true;
        soapRequest.filter(function(a,b){
          if(a['name'] === name){
            console.log(a['code']);
            core.callback=a['callback'];
            $.ajax({
                type: "POST",
                url: nodePath,
                contentType: "text/xml; charset=utf-8",
                dataType: "xml",
                crossDomain: true,
                context: core,
                data: a['code'],
                success: core.callRequest,
                error: core.processError
            });
          }
        });
    },
    submit:function(a,b,c){
      var b=b || "";
      var c=c || "";
      this.reset();
      if(this.page ===  "amostras"){
        this.callService(this.page,a,b,c,'&lt;LINHA_I>'+'1'+'&lt;/LINHA_I>','&lt;LINHA_F>'+'20'+'&lt;/LINHA_F>','&lt;CREATE_DATE_I>2010-04-10&lt;/CREATE_DATE_I>',"&lt;CREATE_DATE_F>2015-10-10&lt;/CREATE_DATE_F>");
      }
      else{
        this.callService(this.page,a,b,'&lt;LINHA_I>'+'1'+'&lt;/LINHA_I>','&lt;LINHA_F>'+'20'+'&lt;/LINHA_F>','&lt;CREATE_DATE_I>2010-04-10&lt;/CREATE_DATE_I>',"&lt;CREATE_DATE_F>2015-10-10&lt;/CREATE_DATE_F>");
      }
    },
    search:function(a){
      var search;
      var forn_desc=this.fornval || "";
      var fair_id=this.fairval || "";
      if(13 === a.keyCode){
        if(isNaN($(a.target).val())){
          search="&lt;AMOS_DESC>"+$(a.target).val()+"&lt;/AMOS_DESC>";
        }
        else{
          search="&lt;AMOS_ID>"+$(a.target).val()+"&lt;/AMOS_ID>";
        }
        this.submit("&lt;FEIR_COD>"+fair_id+"&lt;/FEIR_COD>","&lt;FORN_DESC>"+forn_desc+"&lt;/FORN_DESC>",search);
      }
    },
    processError:function(data, status, req){
      console.log("DEU ERRO");
    },
    setdata:function(a,b){  
      var i,length;
      this.content.page = 0;
      /*this.setBreadcrumb(a,val);
      this.breadEl.find(".bread-load").text(0);*/

      

      if (!this.data.length &amp;&amp; b !="local") {        
        return alert("NENHUMA AMOSTRA***"), $('.bread-search').find(".spec").text("0 Amostras");
        //return this.modal.open(),this.breadEl.find('.bread-colec a').text("").removeClass('active'),this.setloading(!1), this.searchEl.find('input').blur();
      }  
      switch(b){
        case 'amostras':
          this.data = a.sortBy("AMOS_ID");
          console.dir(this.data);
          this.content.changeview(this.view);
          this.createbox(this.data, this.content.page, !0);
          break;
        case 'fornecedores':
          this.data = a.sortBy("FORN_ID");
          this.content.changeview("list");
          this.createbox(this.data, this.content.page, !0,"list");
          break;
        case 'local':
          this.content.changeview("list");
          console.dir(a);
          this.createbox(a, this.content.page, !0,"list");
          break;
        default:
          console.log("ALGO ERRADO");
      }

      /*if(b){
        
      }
      else{
        
      }*/
      
      /*this.content.page = 0;
      
      b ? (this.data = this.data || this.data) : this.data = this.data;*/
      
      //this.content.create(this.data[0]);
            
    },
    callRequest:function(data, status, req){
        if (status == "success") {
          if(this.callback &amp;&amp; "function" === typeof this.callback){
            this.callback(data,req);
          }
        }
    },
    convertData:function(data,req,what,notcombo){
        switch(what){
          case "amostras":
            this.data=jQuery.parseJSON($(req.responseXML).text()).sortBy('AMOS_DESC').unique();
            this.setDate(this.data);
            this.setdata(this.data,"amostras");
            break;
          case "local":
            this.fair=jQuery.parseJSON($(req.responseXML).text()).sortBy('FEIR_DESC').unique();
            break;
          case "fornecedores":
            if(notcombo){
              this.data=jQuery.parseJSON($(req.responseXML).text()).sortBy('FORN_DESC').unique();
              this.setDate(this.data);
              this.setdata(this.data,"fornecedores");
            }
            else{
              this.spotlight.forn=[];
              this.spotlight.forn=jQuery.parseJSON($(req.responseXML).text()).sortBy('FORN_DESC').unique();
              //this.createComponent(this.forn,this.bforn,what);
              this.spotlight.open();
              //this.callService(this.page,"&lt;FEIR_COD>10&lt;/FEIR_COD>","&lt;FORN_ID>4200000&lt;/FORN_ID>",1,20);
            }
            break;
          case "cities":
          console.log("ok");
            this.cities=jQuery.parseJSON($(req.responseXML).text());//.sortBy('FEIR_DESC').unique();
            this.createComponent(this.cities,this.bcity,what);
            break;
          default:
        }
    },
    setDate:function(list){
      var i,length;
      length=list.length;
      console.dir(list);
      for(i=0;i&lt;length;i++){
        list[i].CREATE_DATE=parseJsonDate(list[i].CREATE_DATE).toLocaleDateString();
      }
    },
    createComponent:function(data,comp,what){
        var i,html="";
        switch (what){
          case "fair":
            html+="&lt;option value=''>Local de Coleta: &lt;/option>";
            for(i=0;i&lt;data.length;i++){
              html+="&lt;option value='"+data[i].FEIR_COD.replace("         ","").replace("        ","")+"'>"+data[i].FEIR_DESC+" - "+data[i].PAIS_COD+"&lt;/option>";
            }
            break;
          case "fornecedores":
            html+="&lt;option value=''>Fornecedores: &lt;/option>";
            for(i=0;i&lt;data.length;i++){
              html+="&lt;option value='"+data[i].FORN_ID+"'>"+data[i].FORN_DESC+"&lt;/option>";
            }
            break;
          case "cities":
            comp.empty();
            html+="&lt;option value=''>Cidades: &lt;/option>";
            for(i=0;i&lt;data.length;i++){
              html+="&lt;option value='"+data[i].REGI_COD+"'>"+data[i].REGI_DESC+"&lt;/option>";
            }
            break;
        }
        comp.html(html);
    },
    createbox : function(a, b, d, c) {  
        var f, m, g, n, v;      
        c = c || this.view;
        n = "images" === c ? "li" : "tr";
        this.loading = !0; 
        this.maskEl.fadeIn().find(".loader").show();
        this.active = this.active || this.content;
        d = this.active.itens &amp;&amp; !d ? this.active.itens.length : 0;
        m = 300 * (b + 1) &lt; a.length ? 300 * (b + 1) : a.length;
        var p, h, q, k = 0, l = 21, e = this;
        if (d &lt; a.length &amp;&amp; a[k]) {
            f = setInterval(function() {
                h = a[k];   
                if (!h) {

                    clearInterval(f);
                    e.endloading();
                    return !1;
                }
                if ("images" === c &amp;&amp; l > 0) {
                    /*if (h &amp;&amp; v === h.AMOS_ID)
                      return !1;*/

                    v = h.AMOS_ID || null; 
                    //console.dir(h);
                    //Usando por enquanto o caminho para a imagem large, pois as amostras antigas eram salvas em tamanho muito pequeno
                    p = new Image, q = "http://bdb/ifair_img/"+h.IMG_PATH_SAMPLE.replace("thumb","large"), $(p).load(function() {
                        if (!l > 0)
                            return !1;

                        g = new Box({
                            item : h,
                            view : c,
                            tag : n,
                            // reloadcart : e.proxy(e.reloadcart),
                            detail : e.detail,
                            url : this
                        });

                        e.active.create(g.render());
                    }).error(function() {

                        if (!l > 0)
                            return !1;
                        var a = new Image;
                        //console.log('Sem imagem: *' + h.MATNR + " " + h.MAKTX + " " + h.GRUPO + " " + h.SGRUPO);
                        a.src = "http://189.126.197.169/img/small/small_NONE.jpg";

                        g = new Box({
                            item : h,
                            view : c,
                            tag : n,
                            // reloadcart : e.proxy(e.reloadcart),
                            detail : e.detail,
                            url : a
                        });
                        e.active.create(g.render());
                    }).attr("src", q);

                    // Mostrando (box sendo carregados)
                    $('.bread-search').find(".spec").text(k+1+" Amostras");
                    l--;
                    k++;
                } else {
                    if (l > 0) {
                        return g = new Box({
                            item : h,
                            view : c,
                            tag : n,
                            detail : e.detail,
                            modal : e.modal,
                            page: e.page
                        }), e.active.create(g.render()),l--, k++,!1;
                        //, $('.bread-box').find(".bread-load").text(k+1), l--, k++, !1*/
                    } else {
                        clearInterval(f), e.endloading();
                    }
                }
            }, 300);
        } else {
            return this.endloading(), !1;
        }  
    },  
    stage:function() {
      var a, c;
      "number" === typeof window.innerWidth ? (a = window.innerWidth, c = window.innerHeight) : (a = document.documentElement.clientWidth, c = document.documentElement.clientHeight);
      return{w:a, h:c};
    },  
    endloading : function(a) {
        a &amp;&amp; clearInterval(a);
        var b = this;
        b.getloading(!1);
        /*b.content.itens.fadeIn(function() {
            b.getloading(!1);
        });  */          
    },
    deleteNote:function(a){
      a.preventDefault();
      var obj=$(a.target);
      this.callService("delete",obj.attr("id"),obj.attr("name"));
      obj.closest("li").fadeOut();
    },
    actionHeart:function(a){
      a.preventDefault();
      var obj=$(a.target);
    },
    actionFlag:function(a){
      a.preventDefault();
      var obj=$(a.target);
    },
    actionHomolog:function(a){
      a.preventDefault();
      var obj=$(a.target);
    },
    sortItems : function(a){
      var type,i,length,temp=[];
      if($(a.target).hasClass("sel") || this.loading){
        return !1;
      }
      type=$(a.target).attr("name");
      $("html").attr("class","amostras");
      this.content.reset();
      this.order_box.find("button").removeClass("sel");
      $(a.target).addClass("sel");
      if(type !== "BIGPRICE"){
        length= this.data.length;
        temp = this.data.sortBy(type).unique();
        this.createbox(temp, this.content.page);
      }
      else{
        temp = this.data.sortBy("PE").unique();
        length=this.data.length-1;
        for(i=length;i>=0;i--){
          temp.push(this.data[i]);
        }
        this.createbox(temp.unique(), this.content.page);
      }
    },
    selectItems : function(a){
      if($(a.target).hasClass("sel")){
        //Reseta array
        this.select_items=[];
        $(a.target).removeClass("sel");
        $(".thumbnail .icon").attr("class","icon");
        $("html").attr("class","amostras");
      }
      else{
        //Inicia gravação
        this.select_items=[];
        $(".bsel").removeClass("sel");
        $(a.target).addClass("sel");
        $(".thumbnail .icon").attr("class","icon").addClass($(a.target).attr("name"));
        $("html").attr("class","amostras").addClass("select");
        if($(a.target).hasClass("bedit")){
          $("html").addClass("edit");
        }
      }
    },
    changeCountries: function(a){
      this.callService("cities",'&lt;PAIS_COD>'+$(a.target).find("option:selected").val()+'&lt;/PAIS_COD>','&lt;PAIS_DESC>&lt;/PAIS_DESC>','&lt;REGI_COD>&lt;/REGI_COD>','&lt;REGI_DESC>&lt;/REGI_DESC>');
    },
    filterForn:function(ev){
      var aux;
      aux=this.data;
      this.reset();
      this.fdata = aux.filter(function(a,b){
        if(Boolean(a[$(ev.target).find("option:selected").attr("name")].length) === $(ev.target).find("option:selected").val().bool()){
          return a;
        }
      });
      this.data=aux;
      //console.dir(this.fdata);
      this.content.page = 0;
      this.createbox(this.fdata, this.content.page, !0,"list");
      //console.dir(typeof Boolean($(a.target).find("option:selected").val()));
    },
    compChange:function(ev){
      ev.preventDefault();
      var aux,html="";
      var el=$(ev.target);
      aux=el.closest("ul");
      //console.log(aux.find("a").length);
      if(aux.find("a").length>1){
        el.parent().remove();
        var items=aux.find("a");
        items.each(function(a,b){
          html+="&lt;string>"+$(b).attr("href").replace("#","")+"&lt;/string>";
        });
        this.callService("gravarAmostraComposicao",$(items[0]).attr("name"),html);
      }
      else{
        this.callService("gravarAmostraComposicao",el.attr("name"),"");
        el.parent().remove();
      }
    },
    changeCity:function(val){
      var country,city,context=this,arr=[];
      country=$(".countries").find("option:selected").val();
      city=$(".city").find("option:selected").val();
      this.ffair=[];
      if(this.page !== "local_cadastro"){
        if(this.fair.length){
          arr.push(this.fair.filter(function(a,b){
            if(a.PAIS_COD === country &amp;&amp; a.REGI_COD === city){
              return a;
            }
          }));
          this.ffair=arr[0];
          context.setdata(arr[0],"local");
        }
        else{
          this.callService("local",'&lt;FEIR_COD>&lt;/FEIR_COD>','&lt;PAIS_COD>'+country+'&lt;/PAIS_COD>','&lt;REGI_COD>'+city+'&lt;/REGI_COD>');
        }
      }
    },
    changeFair:function(a){
      this.bforn.val("");
      $(".form-control-search").val("");
      this.fairval=$(a.target).find("option:selected").val();
      this.notcombo=!0;
      this.submit("&lt;FEIR_COD>"+this.fairval+"&lt;/FEIR_COD>");
    },
    exportExcel:function(){
      //Extracted from: http://stackoverflow.com/questions/22317951/export-html-table-data-to-excel-using-javascript-jquery-is-not-working-properl/24081343#24081343

      
      var tab_text="&lt;table border='2px'>&lt;tr bgcolor='#71abcc'>";
      var textRange; var j=0;
      tab = document.getElementById('table'); // id of table

      for(j = 0 ; j &lt; tab.rows.length ; j++) 
      {     
          tab_text=tab_text+tab.rows[j].innerHTML+"&lt;/tr>";
          //tab_text=tab_text+"&lt;/tr>";
      }

      tab_text=tab_text+"&lt;/table>";
      tab_text= tab_text.replace(/&lt;A[^>]*>|&lt;\/A>/g, "");//remove if u want links in your table
      tab_text= tab_text.replace(/&lt;img[^>]*>/gi,""); // remove if u want images in your table
      tab_text= tab_text.replace(/&lt;input[^>]*>|&lt;\/input>/gi, ""); // reomves input params

      var ua = window.navigator.userAgent;
      var msie = ua.indexOf("MSIE "); 

      if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
      {
          txtArea1.document.open("txt/html","replace");
          txtArea1.document.write(tab_text);
          txtArea1.document.close();
          txtArea1.focus(); 
          sa=txtArea1.document.execCommand("SaveAs",true,"WebFair Report.xls");
      }  
      else                 //other browser not tested on IE 11
          sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));  

      return (sa);
    },
    getSpot:function(a){
      //13 === a.keyCode ? (this.spotlight.close(), this.searchEl.trigger("submit")) : (this.filter.close(), 1 &lt; a.target.value.length ? this.spotlight.open(a) : this.spotlight.close());
      if(13 === a.keyCode){
        this.spotlight.select(a);
      }
      else{
        if(3 &lt; a.target.value.length){
          this.spotlight.input=$(a.target);
          if(48 &lt;= a.keyCode &amp;&amp; 90 >= a.keyCode || 8 == a.keyCode) {
                this.notcombo=!1;
                this.callService("fornecedores",'&lt;FORN_DESC>'+a.target.value+'&lt;/FORN_DESC>','&lt;FEIR_COD>'+this.fairval+'&lt;/FEIR_COD>','&lt;LINHA_I>'+'1'+'&lt;/LINHA_I>','&lt;LINHA_F>'+'60'+'&lt;/LINHA_F>','&lt;CREATE_DATE_I>1900-10-17&lt;/CREATE_DATE_I>','');
              }
              else{
                if(40 === a.keyCode || 38 === a.keyCode) {
                  return this.spotlight.arrow(a), !1;
                  //return this.arrow(a), !1;
                }
              }
        }
        else{
          this.spotlight.close();
        }
      }
      return !1;
    },
    getFornVal:function(){
      return this.fornval;
    },
    getFairVal:function(){
      return this.fairval;
    },
    setFairVal:function(a){
      this.fairval=a;
    },
    setFornVal:function(a){
      this.fornval=a;
    },
    getNotCombo:function(){
      return this.notcombo;
    },
    setNotCombo:function(a){
      this.notcombo=a;
    },
    getPage:function(){
      return this.page;
    },
    setPage:function(a){
      this.page=a;
    },
    /**
    * `Set the loading state`
    * @memberOf App#
    * @param {Boolean} a. If true show mask, else hide mask.
    * @param {Boolean} b. If is false, open the loader ebook, else open just the mask div
    */
    setloading: function(a, b) {
      if (!b) {
        if (a) {
          this.maskEl.fadeIn();
          this.loading = !0;
        } else {
          this.maskEl.fadeOut();
          this.loading = !1;
        }
      } else {
        if (a) {
          this.loader.fadeOut();
          this.maskEl.fadeIn();
          this.loading = !0;
        } else {
          this.maskEl.fadeOut();
          this.loader.fadeIn();
          this.loading = !1;
        }
      }
      return this.loading;
    },

    /**
    * `Return loading status`
    * @memberOf App#
    *@return {boolean} status - return loading status
    *
    */
    getloading:function(a){
      a &amp;&amp; !this.loading ? (this.maskEl.fadeIn(), this.loading = !0) : !1 === a &amp;&amp; this.loading &amp;&amp; (this.maskEl.fadeOut(), this.loading = !1);
      return this.loading;
    },

    getdata:function(){
      return this.data;
    },
    reset:function(){
      this.data = [];
      this.fdata = [];
      this.itens = $([]);
      this.itens.remove();
      this.content.reset();
    },
    restartValues:function(){
      //Var to storage the basic data
      this.fairval="";
      this.fornval="";
      this.amosval="";
      this.initialTime='2015-01-08';
      this.endTime='2015-10-10';
      this.notcombo=0;
    }
  });
  new App;
  Spine.Route.setup();
});</pre>
	</article>
</section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		DocStrap Copyright © 2012-2014 The contributors to the JSDoc3 and DocStrap projects.
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0</a>
		on Mon Jul 27th 2015 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>
